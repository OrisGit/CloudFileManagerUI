<div [hidden]="!session.isLoggedIn" class="center">
  <a class="btn btn-outline-success btn-new" (click)="startCreate(); modal.openModal(modalDialog);">Добавить новую запись</a>
  <table mat-table [dataSource]="data" multiTemplateDataRows class="mat-elevation-z8">

    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> Name </th>
      <td mat-cell *matCellDef="let element"> {{element.name}} </td>
    </ng-container>


    <ng-container matColumnDef="release">
      <th mat-header-cell *matHeaderCellDef> Release </th>
      <td mat-cell *matCellDef="let element"> {{element.release}} </td>
    </ng-container>

    <ng-container matColumnDef="pegiRate">
      <th mat-header-cell *matHeaderCellDef> Pegi Rate </th>
      <td mat-cell *matCellDef="let element"> {{element.pegiRate}} </td>
    </ng-container>


    <ng-container matColumnDef="criticsScore">
      <th mat-header-cell *matHeaderCellDef> Critics Score </th>
      <td mat-cell *matCellDef="let element"> {{element.criticsScore}} </td>
    </ng-container>


    <ng-container matColumnDef="personalScore">
      <th mat-header-cell *matHeaderCellDef> Personal Score </th>
      <td mat-cell *matCellDef="let element"> {{element.personalScore}} </td>
    </ng-container>

    <ng-container matColumnDef="update">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element"> <a class="btn btn-outline-primary" (click)="startUpdate(element); modal.openModal(modalDialog)">Обновить</a> </td>
    </ng-container>


    <ng-container matColumnDef="delete">
      <th mat-header-cell *matHeaderCellDef></th>
      <td mat-cell *matCellDef="let element"> <a class="btn btn-outline-danger" (click)="delete(element.id)">Удалить</a> </td>
    </ng-container>

    <ng-container matColumnDef="expandedDetail">
      <td mat-cell *matCellDef="let element" [attr.colspan]="displayedColumns.length">
        <div class="example-element-detail"
             [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">

          <table>
            <tr>
              <td><div class="example-element-description">
                <b>Описание:</b> {{element.description}}
              </div></td>
            </tr>
            <tr>
              <td><div class="example-element-description">
                <b>Разработчик:</b>   {{element.developer.name}}
              </div></td>
            </tr>
            <tr>
              <td>
                <div>
                  <br>
                  <div style="text-align: center; font-weight: bold; font-size: 20px;">
                    Жанры
                  </div>
                  <table mat-table [dataSource]="element.genres" class="mat-elevation-z8">
                    <ng-container matColumnDef="name">
                      <th mat-header-cell *matHeaderCellDef> Name </th>
                      <td mat-cell *matCellDef="let genre"> {{genre.name}} </td>
                    </ng-container>
                    <ng-container matColumnDef="description">
                      <th mat-header-cell *matHeaderCellDef> Description </th>
                      <td mat-cell *matCellDef="let genre"> {{genre.description}} </td>
                    </ng-container>
                    <ng-container matColumnDef="delete">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let genre"> <a class="btn btn-outline-danger" (click)="deleteGenre(element, genre.id)">X</a> </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="['name', 'description', 'delete']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['name', 'description', 'delete'];"></tr>
                  </table>
                </div>
              </td>
            </tr>
            <tr>
              <td>
                <div>
                  <br>
                  <div style="text-align: center; font-weight: bold; font-size: 20px;">
                    Платформы
                  </div>
                  <table mat-table [dataSource]="element.platforms" class="mat-elevation-z8">
                    <ng-container matColumnDef="name">
                      <th mat-header-cell *matHeaderCellDef> Name </th>
                      <td mat-cell *matCellDef="let platform"> {{platform.name}} </td>
                    </ng-container>
                    <ng-container matColumnDef="developer">
                      <th mat-header-cell *matHeaderCellDef> Developer </th>
                      <td mat-cell *matCellDef="let platform"> {{platform.developer}} </td>
                    </ng-container>
                    <ng-container matColumnDef="family">
                      <th mat-header-cell *matHeaderCellDef> Family </th>
                      <td mat-cell *matCellDef="let platform"> {{platform.family}} </td>
                    </ng-container>
                    <ng-container matColumnDef="delete">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let platform"> <a class="btn btn-outline-danger" (click)="deletePlatform(element, platform.id)">X</a> </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="['name', 'developer', 'family', 'delete']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['name', 'developer', 'family', 'delete'];"></tr>
                  </table>
                </div>
              </td>
            </tr>
            <tr>
              <td>
                <div >
                  <br>
                  <div style="text-align: center; font-weight: bold; font-size: 20px;">
                    Издатели
                  </div>
                  <table mat-table [dataSource]="element.publishers" class="mat-elevation-z8">
                    <ng-container matColumnDef="name">
                      <th mat-header-cell *matHeaderCellDef> Name </th>
                      <td mat-cell *matCellDef="let publisher"> {{publisher.name}} </td>
                    </ng-container>
                    <ng-container matColumnDef="headquarters">
                      <th mat-header-cell *matHeaderCellDef> Headquarters </th>
                      <td mat-cell *matCellDef="let publisher"> {{publisher.headquarters}} </td>
                    </ng-container>
                    <ng-container matColumnDef="founded">
                      <th mat-header-cell *matHeaderCellDef> founded </th>
                      <td mat-cell *matCellDef="let publisher"> {{publisher.founded}} </td>
                    </ng-container>
                    <ng-container matColumnDef="delete">
                      <th mat-header-cell *matHeaderCellDef></th>
                      <td mat-cell *matCellDef="let publisher"> <a class="btn btn-outline-danger" (click)="deletePublisher(element, publisher.id)">X</a> </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="['name', 'headquarters', 'founded', 'delete']"></tr>
                    <tr mat-row *matRowDef="let row; columns: ['name', 'headquarters', 'founded', 'delete'];"></tr>
                  </table>
                </div>
              </td>
            </tr>
          </table>
        </div>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let element; columns: displayedColumns;"
        class="example-element-row"
        [class.example-expanded-row]="expandedElement === element"
        (click)="expandedElement = expandedElement === element ? null : element">
    </tr>
    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>
  </table>
</div>



<ng-template #modalDialog let-modal>
  <div class="modal-header">
    <h5 class="modal-title">{{modalHeader}}</h5>
    <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click');">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <form>
      <div class="form-group">
        <label for="name" class="col-form-label">Name:</label>
        <input type="text" class="form-control" id="name" name="name" [(ngModel)]="current.name">
        <label for="release" class="col-form-label">Release:</label>
        <input type="date" class="form-control" id="release" name="release" [(ngModel)]="current.release">
        <label for="pegiRate" class="col-form-label">Pegi Rate:</label>
        <input type="number" min="3" max="21" list="defaultNumbers" class="form-control" id="pegiRate" name="pegiRate" [(ngModel)]="current.pegiRate">
        <span class="validity"></span>
        <datalist id="defaultNumbers">
          <option value="3">
          <option value="7">
          <option value="12">
          <option value="16">
          <option value="18">
        </datalist>
        <label for="description" class="col-form-label">Description:</label>
        <input type="text" class="form-control" id="description" name="description" [(ngModel)]="current.description">
        <label for="criticsScore" class="col-form-label">Critics Score:</label>
        <input type="number" min="0" max="10" class="form-control" id="criticsScore" name="criticsScore" [(ngModel)]="current.criticsScore">
        <label for="personalScore" class="col-form-label">Personal Score:</label>
        <input type="number" min="0" max="10" class="form-control" id="personalScore" name="personalScore" [(ngModel)]="current.personalScore">
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.dismiss('Cross click'); ">Закрыть</button>
    <button type="button" class="btn btn-primary" (click)="modal.dismiss('Save'); commmit()">{{modalButtonText}}</button>
  </div>
</ng-template>
